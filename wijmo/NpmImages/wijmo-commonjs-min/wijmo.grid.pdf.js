/*
    *
    * Wijmo Library 5.20163.234
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the Wijmo Commercial License.
    * sales@wijmo.com
    * http://wijmo.com/products/wijmo-5/license/
    *
    */
"use strict";function tryGetModuleWijmoGridMultirow(){var n,t;return(n=window.wijmo)&&(t=n.grid)&&t.multirow}function _merge(n,t,i){var r,f,u;if(i===void 0&&(i=!1),t&&n)for(r in t)f=t[r],u=n[r],wjcCore.isObject(f)?((u===undefined||!wjcCore.isObject(u)&&i)&&(n[r]=u={}),wjcCore.isObject(u)&&_merge(n[r],f,i)):(u===undefined||i&&f!==undefined)&&(n[r]=f);return n}var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},wjcPdf=require('wijmo/wijmo.pdf'),wjcCore=require('wijmo/wijmo'),wjcGrid=require('wijmo/wijmo.grid'),wjcSelf=require('wijmo/wijmo.grid.pdf'),ScaleMode,ExportMode,FlexGridPdfConverter;window.wijmo=window.wijmo||{};window.wijmo.grid=window.wijmo.grid||{};window.wijmo.grid.pdf=wjcSelf,function(n){n[n.ActualSize=0]="ActualSize";n[n.PageWidth=1]="PageWidth";n[n.SinglePage=2]="SinglePage"}(exports.ScaleMode||(exports.ScaleMode={}));ScaleMode=exports.ScaleMode,function(n){n[n.All=0]="All";n[n.Selection=1]="Selection"}(exports.ExportMode||(exports.ExportMode={}));ExportMode=exports.ExportMode;FlexGridPdfConverter=function(){function n(){}return n.draw=function(n,t,i,r,u){wjcCore.assert(!!n,'The flex argument cannot be null.');wjcCore.assert(!!t,'The doc argument cannot be null.');var f=_merge({},u);_merge(f,this.DefaultDrawSettings);f.scaleMode=i==null?ScaleMode.ActualSize:r==null?ScaleMode.PageWidth:ScaleMode.SinglePage;try{f.recalculateStarWidths&&n.columns._updateStarSizes(wjcPdf.ptToPx(t.width));this._draw(n,t,null,i,r,f)}finally{f.recalculateStarWidths&&n.invalidate(!0)}},n.drawToPosition=function(n,t,i,r,u,f){wjcCore.assert(!!n,'The flex argument cannot be null.');wjcCore.assert(!!t,'The doc argument cannot be null.');wjcCore.assert(!!i,'The point argument cannot be null.');var e=_merge({},f);_merge(e,this.DefaultDrawSettings);e.scaleMode=r==null?ScaleMode.ActualSize:u==null?ScaleMode.PageWidth:ScaleMode.SinglePage;try{e.recalculateStarWidths&&n.columns._updateStarSizes(wjcPdf.ptToPx(t.width));this._draw(n,t,i,r,u,e)}finally{e.recalculateStarWidths&&n.invalidate(!0)}},n.export=function(n,t,i){var u,r;wjcCore.assert(!!n,'The flex argument cannot be null.');wjcCore.assert(!!t,'The fileName argument cannot be empty.');i=_merge({},i);_merge(i,this.DefaultExportSettings);u=i.documentOptions.ended;i.documentOptions.ended=function(n,i){u&&u.apply(r,[n,i])===!1||wjcPdf.saveBlob(i.blob,t)};r=new wjcPdf.PdfDocument(i.documentOptions);try{i.recalculateStarWidths&&n.columns._updateStarSizes(wjcPdf.ptToPx(r.width));this._draw(n,r,null,null,null,i);r.end()}finally{i.recalculateStarWidths&&n.invalidate(!0)}},n._draw=function(n,t,i,r,u,f){var b=i!=null,o=new wjcCore.Size(t.width,t.height),e,w;i||(i=new wjcCore.Point(0,t.y));wjcCore.isArray(f.embeddedFonts)&&f.embeddedFonts.forEach(function(n){t.registerFont(n)});var y=RowRange.getSelection(n,f.exportMode),p=new GridRenderer(n,y,!1,this.BorderWidth,null,!0),s=new wjcCore.Rect(i.x||0,i.y||0,r||o.width,u||o.height),h=this._getScaleFactor(p,f.scaleMode,s),c=this._getPages(n,y,s,f,b,h);for(e=0;e<c.length;e++){e>0&&t.addPage();var l=c[e],a=l.pageCol===0?s.left:0,v=l.pageRow===0?s.top:0;t.saveState();t.paths.rect(0,0,o.width,o.height).clip();t.scale(h,h,new wjcCore.Point(a,v));t.translate(a,v);w=new GridRenderer(n,l.range,f.repeatMergedValuesAcrossPages,this.BorderWidth,f.styles,e===c.length-1);w.render(t);t.restoreState();t.x=a;t.y=v+p.renderSize.height*h}},n._getScaleFactor=function(n,t,i){var u=1,f,r;return t===ScaleMode.ActualSize?u:(f=n.renderSize,t===ScaleMode.SinglePage?(r=Math.min(i.width/f.width,i.height/f.height),r<1&&(u=r)):(r=i.width/f.width,r<1&&(u=r)),u)},n._getPages=function(n,t,i,r,u,f){var ut=this,o=[],s=[],a=wjcPdf.pxToPt,w=n.headersVisibility&wjcGrid.HeadersVisibility.Column,b=n.headersVisibility&wjcGrid.HeadersVisibility.Row,v=w?a(n.columnHeaders.height):0,y=b?a(n.rowHeaders.width):0,ht=r.scaleMode===ScaleMode.ActualSize||r.scaleMode===ScaleMode.PageWidth,ct=r.scaleMode===ScaleMode.ActualSize,lt=(i.width-i.left)*(1/f),at=(i.height-i.top)*(1/f),vt=i.width*(1/f),yt=i.height*(1/f),c=v,l=y,ft=u&&r.scaleMode==ScaleMode.ActualSize,k,d,g,nt,p,tt,e,h,rt,st;if(ht&&(k=0,t.forEach(n.cells,function(n,t,i,r){var f=o.length?yt:at,u;PanelSection.isRenderableRow(n)&&(u=a(n.renderHeight),k++,c+=u,(w||k>1)&&(c-=ut.BorderWidth),c>f&&(v+u>f||ft?(o.push(r),c=v):(o.push(r-1),c=v+u),w&&(c-=ut.BorderWidth)))})),d=t.length()-1,o.length&&o[o.length-1]===d||o.push(d),ct)for(g=0,e=t.leftCol;e<=t.rightCol;e++)nt=n.columns[e],nt.isVisible&&(p=a(nt.renderWidth),tt=s.length?vt:lt,g++,l+=p,(b>0||g>1)&&(l-=this.BorderWidth),l>tt&&(y+p>tt||ft?(s.push(e),l=y):(s.push(e-1),l=y+p),b&&(l-=this.BorderWidth)));s.length&&s[s.length-1]===t.rightCol||s.push(t.rightCol);var et=[],it=!1,ot=1,pt=u&&r.maxPages>0?1:r.maxPages;for(e=0;e<o.length&&!it;e++)for(h=0;h<s.length&&!it;h++,ot++)(it=ot>pt)||(rt=e==0?0:o[e-1]+1,st=h==0?t.leftCol:s[h-1]+1,et.push(new PdfPageRowRange(t.subrange(rt,o[e]-rt+1,st,s[h]),h,e)));return et},n.BorderWidth=1,n.DefaultDrawSettings={maxPages:Number.MAX_VALUE,exportMode:ExportMode.All,repeatMergedValuesAcrossPages:!0,recalculateStarWidths:!0,styles:{cellStyle:{font:new wjcPdf.PdfFont,padding:1.5,verticalAlign:'middle'},headerCellStyle:{font:{weight:'bold'}}}},n.DefaultExportSettings=_merge({scaleMode:ScaleMode.PageWidth,documentOptions:{compress:!1,pageSettings:{margins:{left:36,right:36,top:18,bottom:18}}}},n.DefaultDrawSettings),n}();exports.FlexGridPdfConverter=FlexGridPdfConverter;var PanelSection=function(){function n(n,t){this._panel=n;this._range=t.clone()}return n.isRenderableRow=function(n){return n.isVisible&&!(n instanceof wjcGrid._NewRowTemplate)},Object.defineProperty(n.prototype,"visibleRows",{get:function(){var n=this;return this._visibleRows==null&&(this._visibleRows=0,this._range.forEach(this._panel,function(t){n.isRenderableRow(t)&&n._visibleRows++})),this._visibleRows},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visibleColumns",{get:function(){if(this._visibleColumns==null&&(this._visibleColumns=0,this._range.isValid))for(var n=this._range.leftCol;n<=this._range.rightCol;n++)this._panel.columns[n].isVisible&&this._visibleColumns++;return this._visibleColumns},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){if(this._size==null){var n=this._range.getRenderSize(this._panel);this._size=new wjcCore.Size(wjcPdf.pxToPt(n.width),wjcPdf.pxToPt(n.height))}return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"range",{get:function(){return this._range},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"panel",{get:function(){return this._panel},enumerable:!0,configurable:!0}),n.prototype.isRenderableRow=function(t){return n.isRenderableRow(t)},n}(),PanelSectionRenderer=function(n){function t(t,i,r,u,f,e){n.call(this,i,r);this._flex=t;this._repeatMergedValues=u;this._borderWidth=f;this._styles=e}return __extends(t,n),Object.defineProperty(t.prototype,"renderSize",{get:function(){return this._renderSize==null&&(this._renderSize=this.size.clone(),this.visibleColumns>1&&(this._renderSize.width-=this._borderWidth*(this.visibleColumns-1)),this.visibleRows>1&&(this._renderSize.height-=this._borderWidth*(this.visibleRows-1))),this._renderSize},enumerable:!0,configurable:!0}),t.prototype.getRangeWidth=function(n,t){for(var f,i=0,r=0,e=this.panel,u=n;u<=t;u++)f=e.columns[u],f.isVisible&&(r++,i+=f.renderWidth);return i=wjcPdf.pxToPt(i),r>1&&(i-=this._borderWidth*(r-1)),i},t.prototype.getRangeHeight=function(n,t){for(var f,i=0,r=0,e=this.panel,u=n;u<=t;u++)f=e.rows[u],this.isRenderableRow(f)&&(r++,i+=f.renderHeight);return i=wjcPdf.pxToPt(i),r>1&&(i=i-this._borderWidth*(r-1)),i},t.prototype.render=function(n,t,i){var r=this,u=this.range,o=this.panel,s=new GetMergedRangeProxy(this._flex),f,e;if(u.isValid){for(f={},e=u.leftCol;e<=u.rightCol;e++)f[e]=i;u.forEach(o,function(i,e,h){var k,c,y,l,b;if(r.isRenderableRow(i))for(k=t,c=u.leftCol;c<=u.rightCol;c++){var d=o.columns[c],p=undefined,a=undefined,v=undefined,w=undefined;if(d.isVisible){if(y=r._getCellValue(c,h),(i.allowMerging||d.allowMerging||i instanceof wjcGrid.GroupRow||typeof tryGetModuleWijmoGridMultirow()!="undefined"&&r._flex instanceof tryGetModuleWijmoGridMultirow().MultiRow)&&(l=s.getMergedRange(o,h,c)))if(l.topRow!==l.bottomRow)l.topRow===h||h===e.topRow?p={value:r._repeatMergedValues?y:l.topRow===h?y:'',height:a=r.getRangeHeight(h,Math.min(l.bottomRow,e.bottomRow)),width:v=r.getRangeWidth(c,c)}:v=r.getRangeWidth(c,c);else for(p={value:r._repeatMergedValues?y:c===l.leftCol?y:'',height:a=r.getRangeHeight(h,h),width:v=r.getRangeWidth(Math.max(u.leftCol,l.leftCol),Math.min(u.rightCol,l.rightCol))},w=Math.min(u.rightCol,l.rightCol),b=c+1;b<=w;b++)f[b]+=a-r._borderWidth;else p={value:y,height:a=r.getRangeHeight(h,h),width:v=r.getRangeWidth(c,c)};p&&r._renderCell(n,p,i,d,h,c,k,f[c]);a&&(f[c]+=a-r._borderWidth);v&&(k+=v-r._borderWidth);w&&(c=w)}}})}},t.prototype._getCellValue=function(n,t){var r=this.panel,u=r.getCellData(t,n,!0),i,f,e;return u||u===0||r.cellType!==wjcGrid.CellType.Cell||(i=r.rows[t],i instanceof wjcGrid.GroupRow&&i.dataItem&&i.dataItem.groupDescription&&n===r.columns.firstVisibleIndex&&(f=i.dataItem.groupDescription.propertyName,e=r.columns.getColumn(f),e&&e.header&&(f=e.header),u=f+': '+i.dataItem.name+' ('+i.dataItem.items.length+' items)')),u},t.prototype._isGroupRow=function(n){return n instanceof wjcGrid.GroupRow&&n.hasChildren},t.prototype._renderCell=function(n,t,i,r,u,f,e,o){var h=_merge({},this._styles.cellStyle),a=this.panel,s,c,l;switch(a.cellType){case wjcGrid.CellType.Cell:this._isGroupRow(i)?_merge(h,this._styles.groupCellStyle,!0):typeof tryGetModuleWijmoGridMultirow()!='undefined'&&i instanceof tryGetModuleWijmoGridMultirow()._MultiRow?i.dataIndex%2!=0&&_merge(h,this._styles.altCellStyle,!0):u%2!=0&&_merge(h,this._styles.altCellStyle,!0);break;case wjcGrid.CellType.ColumnHeader:case wjcGrid.CellType.RowHeader:case wjcGrid.CellType.TopLeft:case wjcGrid.CellType.BottomLeft:_merge(h,this._styles.headerCellStyle,!0);break;case wjcGrid.CellType.ColumnFooter:_merge(h,this._styles.headerCellStyle,!0);_merge(h,this._styles.footerCellStyle,!0)}if(s=h,h.font&&((c=h.font.family)&&(s.fontFamily=c),(c=h.font.size)&&(s.fontSize=c),(c=h.font.style)&&(s.fontStyle=c),(c=h.font.weight)&&(s.fontWeight=c),h.font=undefined),!(i instanceof wjcGrid.GroupRow&&!r.aggregate))switch(r.dataType){case wjcCore.DataType.Number:s.textAlign='right';break;case wjcCore.DataType.Boolean:s.textAlign='center'}if(s.left=e,s.top=o,s.width=t.width,s.height=t.height,s.boxSizing='no-box',s.borderWidth=this._borderWidth,s.borderStyle='solid',l=a.grid,a.cellType===wjcGrid.CellType.Cell&&l.rows.maxGroupLevel>=0&&f===l.columns.firstVisibleIndex){var v=i instanceof wjcGrid.GroupRow?Math.max(i.level,0):l.rows.maxGroupLevel+1,y=wjcPdf._asPt(s.paddingLeft||s.padding),p=wjcPdf.pxToPt(v*l.treeIndent);s.paddingLeft=y+p}r.dataType!==wjcCore.DataType.Boolean||a.cellType!==wjcGrid.CellType.Cell||this._isGroupRow(i)?n._renderTextCell(t.value,s):n._renderBooleanCell(t.value,s)},t}(PanelSection),GridRenderer=function(){function n(n,t,i,r,u,f){this._flex=n;this._borderWidth=r;this._lastPage=f;this._topLeft=new PanelSectionRenderer(n,n.topLeftCells,this._showRowHeader&&this._showColumnHeader?new RowRange(n,[new wjcGrid.CellRange(0,0,n.topLeftCells.rows.length-1,n.topLeftCells.columns.length-1)]):new RowRange(n,[]),i,r,u);this._rowHeader=new PanelSectionRenderer(n,n.rowHeaders,this._showRowHeader?t.clone(0,n.rowHeaders.columns.length-1):new RowRange(n,[]),i,r,u);this._columnHeader=new PanelSectionRenderer(n,n.columnHeaders,this._showColumnHeader?new RowRange(n,[new wjcGrid.CellRange(0,t.leftCol,n.columnHeaders.rows.length-1,t.rightCol)]):new RowRange(n,[]),i,r,u);this._cells=new PanelSectionRenderer(n,n.cells,t,i,r,u);this._bottomLeft=new PanelSectionRenderer(n,n.bottomLeftCells,this._showRowHeader&&this._showColumnFooter?new RowRange(n,[new wjcGrid.CellRange(0,0,n.bottomLeftCells.rows.length-1,n.bottomLeftCells.columns.length-1)]):new RowRange(n,[]),i,r,u);this._columnFooter=new PanelSectionRenderer(n,n.columnFooters,this._showColumnFooter?new RowRange(n,[new wjcGrid.CellRange(0,t.leftCol,n.columnFooters.rows.length-1,t.rightCol)]):new RowRange(n,[]),i,r,u)}return n.prototype.render=function(n){var i=Math.max(0,this._rowHeader.renderSize.width-this._borderWidth),t=Math.max(0,this._columnHeader.renderSize.height-this._borderWidth);this._topLeft.render(n,0,0);this._rowHeader.render(n,0,t);this._columnHeader.render(n,i,0);this._cells.render(n,i,t);t=Math.max(0,t+this._cells.renderSize.height-this._borderWidth);this._bottomLeft.render(n,0,t);this._columnFooter.render(n,i,t)},Object.defineProperty(n.prototype,"renderSize",{get:function(){var n=this._columnHeader.renderSize.height+this._cells.renderSize.height+this._columnFooter.renderSize.height,t=this._rowHeader.renderSize.width+this._cells.renderSize.width;return this._columnHeader.visibleRows>0&&(n-=this._borderWidth),this._columnFooter.visibleRows>0&&(n-=this._borderWidth),this._rowHeader.visibleColumns>0&&(t-=this._borderWidth),new wjcCore.Size(t,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"_showColumnHeader",{get:function(){return!!(this._flex.headersVisibility&wjcGrid.HeadersVisibility.Column)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"_showRowHeader",{get:function(){return!!(this._flex.headersVisibility&wjcGrid.HeadersVisibility.Row)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"_showColumnFooter",{get:function(){return this._lastPage&&this._flex.columnFooters.rows.length>0},enumerable:!0,configurable:!0}),n}(),GetMergedRangeProxy=function(){function n(n){this._columns={};this._flex=n}return n.prototype.getMergedRange=function(n,t,i){var r=this._columns[i];return r&&t>=r.topRow&&t<=r.bottomRow?r:this._columns[i]=this._flex.getMergedRange(n,t,i,!1)},n}(),RowRange=function(){function n(n,t){this._flex=n;this._ranges=t||[]}return n.getSelection=function(t,i){var u=[],e,f,r,o;if(i===ExportMode.All)u.push(new wjcGrid.CellRange(0,0,t.rows.length-1,t.columns.length-1));else{e=t.selection;switch(t.selectionMode){case wjcGrid.SelectionMode.Cell:case wjcGrid.SelectionMode.CellRange:u.push(e);break;case wjcGrid.SelectionMode.Row:u.push(new wjcGrid.CellRange(e.topRow,0,e.topRow,t.cells.columns.length-1));break;case wjcGrid.SelectionMode.RowRange:u.push(new wjcGrid.CellRange(e.topRow,0,e.bottomRow,t.cells.columns.length-1));break;case wjcGrid.SelectionMode.ListBox:for(f=-1,r=0;r<t.rows.length;r++)o=t.rows[r],o.isSelected?(f<0&&(f=r),r===t.rows.length-1&&u.push(new wjcGrid.CellRange(f,0,r,t.cells.columns.length-1))):(f>=0&&u.push(new wjcGrid.CellRange(f,0,r-1,t.cells.columns.length-1)),f=-1)}}return new n(t,u)},n.prototype.length=function(){for(var n,i=0,t=0;t<this._ranges.length;t++)n=this._ranges[t],n.isValid&&(i+=n.bottomRow-n.topRow+1);return i},Object.defineProperty(n.prototype,"isValid",{get:function(){return this._ranges.length&&this._ranges[0].isValid},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"leftCol",{get:function(){return this._ranges.length?this._ranges[0].leftCol:-1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rightCol",{get:function(){return this._ranges.length?this._ranges[0].rightCol:-1},enumerable:!0,configurable:!0}),n.prototype.clone=function(t,i){for(var r,f=[],u=0;u<this._ranges.length;u++)r=this._ranges[u].clone(),arguments.length>0&&(r.col=t),arguments.length>1&&(r.col2=i),f.push(r);return new n(this._flex,f)},n.prototype.getRenderSize=function(n){for(var r,t=new wjcCore.Size(0,0),i=0;i<this._ranges.length;i++)r=this._ranges[i].getRenderSize(n),t.width=Math.max(t.width,r.width),t.height+=r.height;return t},n.prototype.forEach=function(n,t){for(var i,r,f=0,u=0;u<this._ranges.length;u++)if(i=this._ranges[u],i.isValid)for(r=i.topRow;r<=i.bottomRow;r++)t(n.rows[r],i,r,f++)},n.prototype.subrange=function(t,i,r,u){var c=[],e,o,s,f;if(t>=0&&i>0)for(e=0,o=0,s=0;s<this._ranges.length&&i>0;s++,e=o+1)if(f=this._ranges[s],o=e+(f.bottomRow-f.topRow),!(t>o)){var h=t>e?f.topRow+(t-e):f.topRow,l=Math.min(f.bottomRow,h+i-1),a=arguments.length>2?r:f.leftCol,v=arguments.length>2?u:f.rightCol;c.push(new wjcGrid.CellRange(h,a,l,v));i-=l-h+1}return new n(this._flex,c)},n}(),PdfPageRowRange=function(){function n(n,t,i){this._col=t;this._row=i;this._range=n}return Object.defineProperty(n.prototype,"range",{get:function(){return this._range},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageCol",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageRow",{get:function(){return this._row},enumerable:!0,configurable:!0}),n}()